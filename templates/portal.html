<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quiz Platform - Portal</title>
    <link rel="stylesheet" href="/static/css/base.css">
    <link rel="stylesheet" href="/static/css/portal.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <div class="page">
        <!-- Toolbar -->
        <div class="toolbar">
            <div>
                <h1>ğŸ“š Cloud Digital Leader Quiz</h1>
                <p class="subtitle small">Practice for the Google Cloud certification</p>
            </div>
            <div class="toolbar-buttons">
                <button type="button" id="btn-home" class="toolbar-btn">ğŸ  Home</button>
                <button type="button" id="btn-dashboard" class="toolbar-btn hidden">ğŸ“Š Dashboard</button>
                <button type="button" id="btn-logout" class="toolbar-btn">ğŸšª Logout</button>
                <button type="button" id="theme-toggle" class="theme-toggle">ğŸŒ™</button>
            </div>
        </div>

        <!-- Identification Card -->
        <div id="login-card" class="card">
            <h2>ğŸ” Identify Yourself</h2>
            <label for="student-dni">Enter your DNI:</label>
            <input type="text" id="student-dni" placeholder="e.g. 12345678A" maxlength="20">
            <button type="button" id="load-dashboard">Load My Dashboard</button>
            <div id="error" class="hidden"></div>
        </div>

        <!-- Dashboard (hidden until login) -->
        <div id="dashboard" class="hidden">
            <!-- Welcome Section -->
            <div class="card">
                <h2 id="student-info">Welcome!</h2>
            </div>

            <div class="two-columns">
                <!-- Left Column: Take a Test -->
                <div class="card">
                    <h2>ğŸ“ Take a Test</h2>
                    
                    <label for="test-select">Select Test:</label>
                    <select id="test-select">
                        <option value="">Loading...</option>
                    </select>
                    
                    <div style="margin-top: 0.5rem; display: flex; gap: 0.5rem; flex-wrap: wrap;">
                        <button type="button" id="start-selected-test">â–¶ï¸ Start Test</button>
                        <button type="button" id="view-podium-btn">ğŸ† View Podium</button>
                        <button type="button" id="rename-my-test-btn" class="hidden">âœï¸ Rename Test</button>
                    </div>
                    
                    <div id="podium-info" style="margin-top: 0.5rem;"></div>
                    <div id="rename-info" style="margin-top: 0.5rem;"></div>

                    <h3 style="margin-top: 1.2rem;">ğŸ² Create Random Test</h3>
                    
                    <label for="test-name">Test Name (optional):</label>
                    <input type="text" id="test-name" placeholder="My Custom Test" maxlength="100">
                    
                    <label for="num-questions">Number of Questions:</label>
                    <input type="number" id="num-questions" value="20" min="1" max="100">
                    
                    <!-- Max attempts (teacher only) -->
                    <div id="max-attempts-container" class="hidden">
                        <label for="max-attempts">Max Attempts (leave empty for unlimited):</label>
                        <input type="number" id="max-attempts" placeholder="âˆ" min="1" max="100">
                    </div>
                    
                    <button type="button" id="create-random-test">ğŸ¯ Create & Start</button>
                    <div id="random-info" style="margin-top: 0.5rem;"></div>
                </div>

                <!-- Right Column: My Attempts -->
                <div class="card">
                    <h2>ğŸ“ˆ My Attempts</h2>
                    
                    <div id="attempts-empty" class="hidden">
                        <p style="color: var(--text-muted); font-style: italic;">No attempts yet. Take a test to see your results here!</p>
                    </div>
                    
                    <div id="attempts-table-wrapper" class="hidden">
                        <div class="table-container">
                            <table>
                                <thead>
                                    <tr>
                                        <th>Date</th>
                                        <th>Test</th>
                                        <th>#</th>
                                        <th>Score</th>
                                        <th>%</th>
                                        <th>Status</th>
                                    </tr>
                                </thead>
                                <tbody id="attempts-table-body">
                                </tbody>
                            </table>
                        </div>
                    </div>
                    
                    <div style="height: 180px; margin-top: 1rem;">
                        <canvas id="attempts-chart"></canvas>
                    </div>
                </div>
            </div>

            <!-- Teacher Panel (hidden for students) -->
            <div id="teacher-panel" class="card hidden">
                <h2>ğŸ‘©â€ğŸ« Teacher Panel</h2>
                <p class="small" style="margin-bottom: 1rem; color: var(--text-muted);">
                    Manage tests and view detailed analytics.
                </p>
                
                <div style="display: flex; gap: 0.5rem; flex-wrap: wrap; margin-bottom: 0.5rem;">
                    <button type="button" id="delete-test-btn">ğŸ—‘ï¸ Delete Test</button>
                    <button type="button" id="rename-test-btn">âœï¸ Rename Test</button>
                    <button type="button" id="load-analytics-btn">ğŸ“Š Show Analytics</button>
                </div>
                
                <div id="delete-test-info" style="margin-top: 0.5rem;"></div>
                <div id="analytics-output" style="margin-top: 0.5rem;"></div>
            </div>
        </div>

        <!-- Footer with version -->
        <footer style="text-align: center; margin-top: 2rem; padding: 1rem; color: var(--text-muted); font-size: 0.85rem;">
            <p id="version-display">Loading version...</p>
            <p style="margin-top: 0.5rem;">
                This quiz platform is for educational purposes only. 
                Questions are based on publicly available Google Cloud documentation.
            </p>
        </footer>
    </div>

    <script src="/static/js/portal.js"></script>
    <script>
        // Fetch and display version
        fetch('/version')
            .then(r => r.json())
            .then(data => {
                document.getElementById('version-display').textContent = 
                    'Version: ' + (data.version || 'unknown');
            })
            .catch(() => {
                document.getElementById('version-display').textContent = 'Version: unknown';
            });
    </script>
</body>
</html>
